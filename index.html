<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>InColor â€“ ë‹¹ì‹ ì˜ ì²«ì‚¬ë‘ì€ ë¬´ìŠ¨ ìƒ‰?</title>
<style>
  :root{
    --bg:#fff9fd;
    --ink:#2b2b2b;
    --card:#ffffff;
    --accent:#ff7ad9;   /* ë©”ì¸ í¬ì¸íŠ¸ */
    --accent-2:#9b8cff; /* ë³´ì¡° í¬ì¸íŠ¸ */
    --soft:#ffe7f4;
    --shadow: 0 8px 24px rgba(0,0,0,.08);
    --radius: 18px;
  }
  *{box-sizing:border-box}
  html,body{margin:0; padding:0; background:linear-gradient(135deg,#fff9fd, #f6f3ff); color:var(--ink); font-family: ui-rounded, "Pretendard Variable", "Apple SD Gothic Neo", "Noto Sans KR", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; }
  .wrap{max-width:720px; margin:24px auto 80px; padding:16px;}
  header{
    display:flex; align-items:center; justify-content:center; gap:10px;
    margin:6px auto 16px; padding:14px 16px; border-radius:999px;
    background:linear-gradient(90deg, var(--soft), #efe9ff);
    width:max-content; box-shadow: var(--shadow);
  }
  header .mark{font-size:22px}
  header h1{margin:0; font-size:18px; font-weight:800; letter-spacing:.2px;}
  .card{
    background:var(--card); border-radius:var(--radius); padding:20px;
    box-shadow: var(--shadow);
    animation: pop .35s ease;
  }
  @keyframes pop{from{transform:scale(.98); opacity:0} to{transform:scale(1); opacity:1}}
  .title{
    font-size:22px; font-weight:900; line-height:1.35; margin:6px 0 14px;
  }
  .hint{font-size:14px; color:#666; margin-top:4px}
  .qtext{font-size:20px; font-weight:800; margin:6px 0 14px; line-height:1.45}
  .options{display:grid; gap:12px}
  .btn{
    width:100%; border:none; border-radius:16px; padding:14px 16px;
    font-size:16px; font-weight:800; cursor:pointer; text-align:left;
    background:linear-gradient(180deg,#ffffff,#f7f3ff);
    box-shadow: inset 0 0 0 2px #eee, 0 8px 16px rgba(0,0,0,.05);
    transition: transform .05s ease, box-shadow .2s ease;
  }
  .btn:hover{transform: translateY(-1px); box-shadow: inset 0 0 0 2px #e6ddff, 0 10px 18px rgba(155,140,255,.18)}
  .btn .em{font-size:18px; margin-right:6px}
  .progress{
    display:flex; gap:8px; align-items:center; justify-content:center; margin:14px 0 6px;
  }
  .dot{width:10px; height:10px; border-radius:50%; background:#e9e5ff; opacity:.6}
  .dot.on{background:linear-gradient(180deg, var(--accent-2), #c7bfff); opacity:1; box-shadow:0 0 0 3px #efeaff}
  .footer{
    margin-top:12px; display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
  }
  .pill{
    border:none; border-radius:999px; padding:10px 14px; font-weight:800; cursor:pointer;
    background:linear-gradient(90deg, var(--accent), var(--accent-2)); color:white; box-shadow: var(--shadow);
  }
  .ghost{
    background:#fff; color:#7a6cff; box-shadow: inset 0 0 0 2px #e8e3ff; }
  .result{
    text-align:center; padding:22px 18px; border-radius:var(--radius);
    background:linear-gradient(180deg,#fff,#fff4fb);
    box-shadow: var(--shadow);
  }
  .chip{
    width:120px; height:120px; border-radius:50%; margin:14px auto; box-shadow: inset 0 0 0 6px rgba(255,255,255,.8), 0 10px 24px rgba(0,0,0,.15);
  }
  .rtitle{font-size:22px; font-weight:900; margin:10px 0 6px}
  .rdesc{font-size:16px; color:#555}
  .inline-note{background:#fff; border-radius:12px; padding:10px 12px; box-shadow:inset 0 0 0 2px #ffe3f2}
  .share{display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:16px}
  .mini{font-size:12px; color:#777; text-align:center; margin-top:12px}
  /* confetti canvas */
  #confetti{position:fixed; inset:0; pointer-events:none; z-index:9}
</style>
</head>
<body>
<canvas id="confetti"></canvas>

<div class="wrap">
  <header>
    <div class="mark">ğŸˆ</div>
    <h1>InColor â€” ë‹¹ì‹ ì˜ ì²«ì‚¬ë‘ì€ ë¬´ìŠ¨ ìƒ‰?</h1>
  </header>

  <div class="card" id="screen-intro">
    <div class="title">ì¶•ì œ í•œì • ğŸ’˜ <span style="color:var(--accent-2)">ì»¬ëŸ¬ ì‹¬ë¦¬í…ŒìŠ¤íŠ¸</span></div>
    <div class="hint">ì•„ë˜ ì§ˆë¬¸ì— A/Bë¡œ ë‹µí•˜ë©´, ë‹¹ì‹ ì˜ ì²«ì‚¬ë‘ì„ ë‹®ì€ ìƒ‰(12ê°€ì§€)ê³¼ ì§§ì€ ì„¤ëª…ì´ ë‚˜ì™€ìš”!</div>
    <div style="margin:14px 0 8px">
      <label class="inline-note">ë‹‰ë„¤ì„(ì„ íƒ)
        <input id="nickname" type="text" placeholder="ì˜ˆ: ì´ˆì½”ì†Œë¼ë¹µ" style="border:none; outline:none; margin-left:8px; font-weight:700; width:160px; background:transparent" />
      </label>
    </div>
    <div class="footer">
      <button class="pill" id="start">ì‹œì‘í•˜ê¸° âœ¨</button>
      <button class="pill ghost" id="how">ì§„í–‰ ë°©ì‹ ë³´ê¸°</button>
    </div>
  </div>

  <div id="flow" class="card" style="display:none">
    <div class="progress" id="progress"></div>
    <div class="qtext" id="qtext"></div>
    <div class="options" id="opts"></div>
    <div class="footer">
      <button class="pill ghost" id="back">â† ì´ì „</button>
      <button class="pill" id="restart" style="display:none">ë‹¤ì‹œí•˜ê¸° ğŸ”</button>
    </div>
  </div>

  <div id="final" class="card" style="display:none">
    <div class="result">
      <div id="chip" class="chip"></div>
      <div class="rtitle" id="rtitle"></div>
      <div class="rdesc" id="rdesc"></div>
      <div style="margin-top:14px">
        <textarea id="story" rows="3" placeholder="í•œ ì¤„ ì‚¬ì—°ì„ ì ì–´ì£¼ì„¸ìš” (ì„ íƒ)" style="width:100%; border-radius:12px; border:2px solid #f2e9ff; padding:10px; resize:vertical; font-family:inherit"></textarea>
      </div>
      <div class="share">
        <button class="pill" id="copy">ê²°ê³¼ ë³µì‚¬ ğŸ“‹</button>
        <button class="pill ghost" id="again">ë‹¤ì‹œí•˜ê¸° ğŸ”</button>
      </div>
      <div class="mini">ê²°ê³¼ëŠ” ë¡œì»¬ì—ì„œë§Œ ì‚¬ìš©ë¼ìš”. ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
    </div>
  </div>

  <div id="howto" class="card" style="display:none">
    <div class="title">ì–´ë–»ê²Œ ì§„í–‰ë˜ë‚˜ìš”? ğŸ§­</div>
    <ol style="margin-top:6px; line-height:1.7">
      <li>ì´ 3~4ë²ˆì˜ A/B ì§ˆë¬¸ì— ë‹µí•©ë‹ˆë‹¤.</li>
      <li>ë¶„ê¸°í˜• ë¡œì§ìœ¼ë¡œ ìµœì¢… ìƒ‰(12ê°€ì§€) ì¤‘ í•˜ë‚˜ê°€ ë„ì¶œë©ë‹ˆë‹¤.</li>
      <li>ê²°ê³¼ë¥¼ ë³µì‚¬í•´ì„œ ì‚¬ì—° ì‘ëª¨ì— ë¶™ì—¬ ë„£ê±°ë‚˜, ë¶€ìŠ¤ ìŠ¤íƒœí”„ì—ê²Œ ë³´ì—¬ì£¼ì„¸ìš”!</li>
    </ol>
  </div>

</div>

<script>
/* ---------- ë°ì´í„°: 12ìƒ‰ íŒ”ë ˆíŠ¸ & ì„¤ëª… ---------- */
const COLORS = {
  Red:      { hex:"#ff3b30",  desc:"ì—´ì •ê³¼ ê°•ë ¬í•¨. ë§Œë‚˜ë©´ ì‹¬ì¥ì´ ë¨¼ì € ë°˜ì‘í•˜ë˜ ê·¸ë•Œ!" },
  Orange:   { hex:"#ff9500",  desc:"í™œê¸°ì™€ ì¦ê±°ì›€. í•¨ê»˜ ìˆìœ¼ë©´ ì‹œê°„ ìˆœì‚­ì´ë˜ ë‘ ì‚¬ëŒ." },
  Pink:     { hex:"#ff6ea9",  desc:"ë‹¬ì½¤í•˜ê³  ìˆ˜ì¤ì€ ê¸°ë¥˜. ì†ë ìŠ¤ì¹˜ëŠ” ìˆœê°„ì´ ì˜í™” ê°™ì•˜ë˜." },
  Yellow:   { hex:"#ffd60a",  desc:"ë°ê³  í•´ë§‘ì€ í–‡ì‚´. ì›ƒìŒì´ ë¨¼ì € ë– ì˜¤ë¥´ëŠ” ê¸°ì–µ." },
  Green:    { hex:"#34c759",  desc:"ì•ˆì •ê³¼ ì„±ì¥. ì„œë¡œë¥¼ ì¡°ìš©íˆ ì§€ì§€í•´ì¤€ ë™ë°˜ì ê°™ì€ ëŠë‚Œ." },
  Mint:     { hex:"#2ed1c5",  desc:"ì²­ëŸ‰í•œ ì²«ì¸ìƒ. ì²« ë§Œë‚¨ì˜ ìƒì¾Œí•¨ì´ ì˜¤ë˜ ë‚¨ì•„ìˆë‹¤." },
  Blue:     { hex:"#0a84ff",  desc:"ì°¨ë¶„í•˜ê³  ë‹´ë°±í•œ í˜¸í¡. ì˜¤ë˜ ê³±ì”¹ì–´ë„ í¸ì•ˆí•œ ê°ì •." },
  Navy:     { hex:"#223a5e",  desc:"ê¹Šì´ì™€ ê·¸ë¦¬ì›€. ì‹œê°„ ì§€ë‚˜ë„ ì”í–¥ì´ ë‚¨ëŠ” ì—¬ìš´." },
  Purple:   { hex:"#a259ff",  desc:"ì‹ ë¹„ë¡­ê³  íŠ¹ë³„í–ˆë˜ ì—°ê²°. ìš´ëª… ê°™ì€ íƒ€ì´ë°ì˜ ì—°ì†." },
  Lavender: { hex:"#c8a2ff",  desc:"ì„¬ì„¸í•˜ê³  í¬ê·¼í•œ ìœ„ë¡œ. ì¡°ìš©íˆ ë§ˆìŒì„ ê°ì‹¸ì¤€ ê¸°ì–µ." },
  White:    { hex:"#ffffff",  desc:"ìˆœìˆ˜í•œ ì‹œì‘. ì•„ë¬´ê²ƒë„ ëª°ëë˜ íˆ¬ëª…í•œ ë§ˆìŒ ê·¸ëŒ€ë¡œ." },
  Black:    { hex:"#111111",  desc:"ë¯¸ì™„ê³¼ ë¹„ë°€, ê·¸ëŸ¬ë‚˜ ìŠíˆì§€ ì•ŠëŠ” ì¥ë©´." }
};

/* ---------- ì§ˆë¬¸ íŠ¸ë¦¬ (ë” êµ¬ì²´ì ì¸ ë¬¸ì¥ìœ¼ë¡œ êµ¬ì„±) ----------

íŠ¸ë¦¬ êµ¬ì¡°:
Q1 â†’ (A) Q2-1, (B) Q2-2
Q2-1 â†’ (A) Q3-1, (B) Q3-2
Q2-2 â†’ (A) Q3-3, (B) Q3-4
ê° Q3-xëŠ” 3ê°œ ê°ˆë˜(2ì§€ì„ ë‹¤ + 'ë” ê°€ê¹ë‹¤ë©´' ë³´ì¡°ì„ íƒ)ë¥¼ í†µí•´ 12ìƒ‰ ì™„ì„±

*/
const FLOW = {
  start: "Q1",
  nodes: {
    "Q1": {
      text: "ì²« ë§Œë‚¨ì„ ë– ì˜¬ë¦¬ë©´ ì–´ë–¤ ì¥ë©´ì´ ë” ê°€ê¹Œì›Œìš”?",
      a: { label:"ğŸ”¥ ì‹¬ì¥ì´ ë¨¼ì €! ë°¤ëŠ¦ê²Œê¹Œì§€ í†¡ì´ ìŸì•„ì§„ë‹¤", next:"Q2-1", icon:"ğŸ’Œ" },
      b: { label:"ğŸƒ í¸ì•ˆí•¨ ë¨¼ì €! ì‚°ì±…Â·ì¹´í˜ì—ì„œ ëŒ€í™”ê°€ ê¸¸ì–´ì§„ë‹¤", next:"Q2-2", icon:"â˜•" }
    },
    "Q2-1": {
      text: "ë‘ ì‚¬ëŒì˜ ë¦¬ë“¬ì€ ì–´ë• ë‚˜ìš”?",
      a: { label:"âš¡ ë¶ˆê½ƒì²˜ëŸ¼ ê¸‰ê²©íˆ ê°€ê¹Œì›Œì¡Œë‹¤ (ì¦‰í¥ ë°ì´íŠ¸, ê¸°ìŠµ ê³ ë°±)", next:"Q3-1", icon:"ğŸ¢" },
      b: { label:"ğŸŒ™ ì„¤ë ˜ì€ ìˆì§€ë§Œ ì°¨ë¶„íˆ ê¹Šì–´ì¡Œë‹¤ (ê¸´ í†µí™”, ì†í¸ì§€, ê¸°ë¡)", next:"Q3-2", icon:"ğŸ“–" }
    },
    "Q2-2": {
      text: "ì„œë¡œê°€ í˜ì´ ë˜ë˜ ìˆœê°„ì„ ê³ ë¥¸ë‹¤ë©´?",
      a: { label:"ğŸ«¶ ì‹œí—˜Â·ê³¼ì œ ë•Œ ì„œë¡œ ì±™ê²¨ì£¼ë©° ì„±ì¥í–ˆë‹¤", next:"Q3-3", icon:"ğŸ“š" },
      b: { label:"ğŸ«§ ë³„ë§ ì—†ì–´ë„ ì˜†ì— ìˆìœ¼ë©´ ì•ˆì •ì„ ì¤¬ë‹¤", next:"Q3-4", icon:"ğŸ•¯ï¸" }
    },

    // Q3-1 : Red / Orange / Pink
    "Q3-1": {
      text: "ê°€ì¥ ë‹®ì€ ê²°ì„ í•˜ë‚˜ ê³¨ë¼ì£¼ì„¸ìš”.",
      a: { label:"â¤ï¸ ê°•ë ¬í•œ ëŒë¦¼ê³¼ ìŠ¤íŒŒí¬ê°€ í•µì‹¬ì´ì—ˆë‹¤", color:"Red", icon:"âœ¨" },
      b: { label:"ğŸ§¡ ë§Œë‚  ë•Œë§ˆë‹¤ í…ì…˜ ì—…! ì¦ê±°ì›€ì´ í•µì‹¬ì´ì—ˆë‹¤", next:"Q3-1b", icon:"ğŸ‰" },
      alt:{ label:"ğŸ’— (ë§ì„¤ì´ë©´) ìˆ˜ì¤ê³  ë‹¬ì½¤í•œ ë¶„ìœ„ê¸°ê°€ ë” ì»¸ë‹¤", color:"Pink", icon:"ğŸ°" }
    },
    "Q3-1b": { // Orange / Pink
      text: "í•œ ë²ˆë§Œ ë”! ë” ê°€ê¹Œìš´ ìª½ì€?",
      a: { label:"ğŸ§¡ í™œê¸°Â·ëª¨í—˜Â·ì›ƒìŒ í¬ì¸íŠ¸ê°€ ë§ì•˜ë‹¤", color:"Orange", icon:"ğŸ›¼" },
      b: { label:"ğŸ’— ë¶€ë„ëŸ¬ìš´ ëˆˆë§ì¶¤ê³¼ ì„¤ë ˜ì´ í¬ì¸íŠ¸ì˜€ë‹¤", color:"Pink",   icon:"ğŸŒ·" }
    },

    // Q3-2 : Blue / Navy / Purple
    "Q3-2": {
      text: "ê°ì •ì˜ ìƒ‰ê°ì€ ì–´ëŠ ìª½ì— ê°€ê¹Œì› ë‚˜ìš”?",
      a: { label:"ğŸ’™ ì”ì”í•˜ê³  ë‹´ë°±, ì˜¤ë˜ ê³ì— ë‘ê³ í”ˆ í‰ì˜¨", color:"Blue", icon:"ğŸ«§" },
      b: { label:"ğŸŒŒ ê¹Šê³  ì§„ì¤‘, ì‹œê°„ì´ ì§€ë‚˜ë„ ë§´ë„ëŠ” ì—¬ìš´", next:"Q3-2b", icon:"ğŸŒ™" },
      alt:{ label:"ğŸ”® íŠ¹ë³„í•˜ê³  ìš´ëª… ê°™ì€ ê¸°ì‹œê°ì´ ìˆì—ˆë‹¤", color:"Purple", icon:"ğŸª„" }
    },
    "Q3-2b": { // Navy / Purple
      text: "í•œ ë²ˆë§Œ ë”! ë” ê°€ê¹Œìš´ ìª½ì€?",
      a: { label:"ğŸŒŠ ê¹Šì´Â·ê·¸ë¦¬ì›€ì˜ ë†ë„ê°€ ì§™ì—ˆë‹¤", color:"Navy",   icon:"ğŸŒŠ" },
      b: { label:"ğŸ”® ì‹ ë¹„ë¡­ê³  íŠ¹ë³„í•œ ì‚¬ê±´ë“¤ì´ ë§ì•˜ë‹¤", color:"Purple", icon:"âœ¨" }
    },

    // Q3-3 : Green / Yellow / Mint
    "Q3-3": {
      text: "í•¨ê»˜ ìˆë˜ ì¥ë©´ì„ ë– ì˜¬ë¦¬ë©´?",
      a: { label:"ğŸŒ¿ ì„œë¡œë¥¼ ë¶ë‹ìš°ë©° ì„±ì¥Â·ë£¨í‹´ì„ í•¨ê»˜ ë§Œë“¤ì—ˆë‹¤", color:"Green", icon:"ğŸƒ" },
      b: { label:"ğŸ’› ë§Œë‚  ë•Œë§ˆë‹¤ í•´ë§‘ê²Œ ì›ƒê³  ì‚¬ì§„ì´ ë§ë‹¤", next:"Q3-3b", icon:"ğŸ“¸" },
      alt:{ label:"ğŸ«§ ì²« ë§Œë‚¨ì˜ ìƒì¾Œí•¨Â·ì²­ëŸ‰ê°ì´ ì˜¤ë˜ ë‚¨ëŠ”ë‹¤", color:"Mint", icon:"ğŸƒ" }
    },
    "Q3-3b": { // Yellow / Mint
      text: "í•œ ë²ˆë§Œ ë”! ë” ê°€ê¹Œìš´ ìª½ì€?",
      a: { label:"ğŸ’› ë°ìŒÂ·í–‰ë³µì´ í•µì‹¬ í†¤ì´ë‹¤", color:"Yellow", icon:"ğŸŒ" },
      b: { label:"ğŸŒ± ì²­ëŸ‰Â·ì‹ ì„ ì´ í•µì‹¬ í†¤ì´ë‹¤", color:"Mint",   icon:"ğŸ«§" }
    },

    // Q3-4 : Lavender / White / Black
    "Q3-4": {
      text: "ê·¸ ë§ˆìŒì„ ê°€ì¥ ì˜ ì„¤ëª…í•˜ëŠ” ë¬¸ì¥ì€?",
      a: { label:"ğŸ’œ ì§€ì¹œ ë‚ ì—” ë§ ì—†ì´ë„ ìœ„ë¡œê°€ ë˜ì—ˆë‹¤", color:"Lavender", icon:"ğŸ«–" },
      b: { label:"ğŸ¤ ëª¨ë“  ê²Œ ì²˜ìŒì´ë¼ ì„œíˆ´ì§€ë§Œ ì§„ì‹¬ì´ì—ˆë‹¤", next:"Q3-4b", icon:"ğŸ“„" },
      alt:{ label:"ğŸ–¤ ì´ë£¨ì–´ì§€ì§€ ì•Šì•˜ì–´ë„ ì„ ëª…í•˜ê²Œ ë‚¨ì•„ìˆë‹¤", color:"Black", icon:"ğŸ–‹ï¸" }
    },
    "Q3-4b": { // White / Black
      text: "í•œ ë²ˆë§Œ ë”! ë” ê°€ê¹Œìš´ ìª½ì€?",
      a: { label:"ğŸ¤ ìˆœìˆ˜Â·ê¹¨ë—Â·ì‹œì‘ì˜ ì´ë¯¸ì§€", color:"White", icon:"ğŸ•Šï¸" },
      b: { label:"ğŸ–¤ ë¯¸ì™„Â·ë¹„ë°€Â·ì´ë³„ì˜ ì´ë¯¸ì§€", color:"Black", icon:"ğŸŒ‘" }
    }
  }
};

/* ---------- ìƒíƒœ ë° UI ìš”ì†Œ ---------- */
const $intro   = document.getElementById("screen-intro");
const $flow    = document.getElementById("flow");
const $final   = document.getElementById("final");
const $howto   = document.getElementById("howto");
const $qtext   = document.getElementById("qtext");
const $opts    = document.getElementById("opts");
const $progress= document.getElementById("progress");
const $chip    = document.getElementById("chip");
const $rtitle  = document.getElementById("rtitle");
const $rdesc   = document.getElementById("rdesc");
const $nickname= document.getElementById("nickname");
const $story   = document.getElementById("story");

let historyStack = []; // ì´ì „ìœ¼ë¡œ ê°€ê¸°ìš©
let currentNode  = FLOW.start;
let nickname     = "";

/* ---------- ì§„í–‰ë„ ì (ëŒ€ëµ 4ìŠ¤í… í‘œì‹œ) ---------- */
function renderProgress(step){
  $progress.innerHTML = "";
  const total = 4;
  for(let i=1;i<=total;i++){
    const dot = document.createElement("div");
    dot.className = "dot" + (i<=step ? " on" : "");
    $progress.appendChild(dot);
  }
}

/* ---------- ì§ˆë¬¸ í™”ë©´ ë Œë” ---------- */
function renderNode(id, step=1){
  currentNode = id;
  const node = FLOW.nodes[id];
  if(!node) return;
  renderProgress(step);

  $qtext.textContent = node.text;

  $opts.innerHTML = "";
  const mkBtn = (choice) => {
    const btn = document.createElement("button");
    btn.className = "btn";
    btn.innerHTML = `<span class="em">${choice.icon||"ğŸ€"}</span>${choice.label}`;
    btn.onclick = () => {
      historyStack.push({ id, step });
      if (choice.color){
        showResult(choice.color);
      } else if (choice.next){
        const nextStep = Math.min(step+1, 4);
        renderNode(choice.next, nextStep);
      }
    };
    return btn;
  };
  $opts.appendChild(mkBtn(node.a));
  $opts.appendChild(mkBtn(node.b));
  if(node.alt){
    const subtle = mkBtn(node.alt);
    subtle.style.opacity = .92;
    subtle.style.background = "linear-gradient(180deg,#ffffff,#fff6fb)";
    $opts.appendChild(subtle);
  }

  document.getElementById("restart").style.display = "none";
}

/* ---------- ê²°ê³¼ í™”ë©´ ---------- */
function showResult(colorKey){
  const meta = COLORS[colorKey];
  $flow.style.display   = "none";
  $final.style.display  = "block";

  $chip.style.background = meta.hex;
  const name = nickname ? `${nickname}ë‹˜ì˜ ` : "ë‹¹ì‹ ì˜ ";
  $rtitle.innerHTML = `${name}ì²«ì‚¬ë‘ ìƒ‰ì€ <b style="color:${meta.hex}">${colorKey}</b>`;
  $rdesc.textContent = meta.desc;

  fireConfetti(); // ì¶•í•˜ ì´í™íŠ¸
}

/* ---------- í™”ë©´ ì „í™˜ ---------- */
document.getElementById("start").onclick = () => {
  nickname = ($nickname.value||"").trim();
  $intro.style.display = "none";
  $howto.style.display = "none";
  $flow.style.display  = "block";
  historyStack = [];
  renderNode(FLOW.start, 1);
};

document.getElementById("how").onclick = () => {
  $howto.style.display = $howto.style.display==="none" ? "block":"none";
};

document.getElementById("back").onclick = () => {
  if(!historyStack.length) {
    // ì¸íŠ¸ë¡œë¡œ
    $flow.style.display = "none";
    $intro.style.display = "block";
    return;
  }
  const prev = historyStack.pop();
  renderNode(prev.id, prev.step);
};

document.getElementById("again").onclick =
document.getElementById("restart").onclick = () => {
  $final.style.display = "none";
  $flow.style.display  = "block";
  historyStack = [];
  renderNode(FLOW.start, 1);
};

document.getElementById("copy").onclick = async () => {
  const text = [
    `${nickname ? `${nickname}ì˜ `:""}ì²«ì‚¬ë‘ ì»¬ëŸ¬ ê²°ê³¼`,
    `â€¢ Color : ${$rtitle.textContent.replace("ë‹˜ì˜ ","").replace("ë‹¹ì‹ ì˜ ","")}`,
    `â€¢ ì˜ë¯¸ : ${$rdesc.textContent}`,
    $story.value.trim() ? `â€¢ ì‚¬ì—° : ${$story.value.trim()}` : ""
  ].filter(Boolean).join("\n");
  try{
    await navigator.clipboard.writeText(text);
    toast("ê²°ê³¼ê°€ ë³µì‚¬ë˜ì—ˆì–´ìš”! âœ¨");
  }catch(e){
    alert("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆì–´ìš”. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.");
  }
};

/* ---------- í† ìŠ¤íŠ¸ ---------- */
function toast(msg){
  const el = document.createElement("div");
  el.textContent = msg;
  el.style.cssText = `
    position:fixed; left:50%; bottom:24px; transform:translateX(-50%);
    background:linear-gradient(90deg, var(--accent), var(--accent-2));
    color:#fff; padding:10px 14px; border-radius:999px; box-shadow:${getComputedStyle(document.documentElement).getPropertyValue('--shadow')}; z-index:10; font-weight:800;
  `;
  document.body.appendChild(el);
  setTimeout(()=>{ el.style.opacity="0"; el.style.transition="opacity .4s"; },1400);
  setTimeout(()=> el.remove(), 1900);
}

/* ---------- ê°„ë‹¨í•œ ì½˜í˜í‹° ---------- */
const confettiCanvas = document.getElementById("confetti");
const ctx = confettiCanvas.getContext("2d");
let confs = [];
function resizeCanvas(){
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height= window.innerHeight;
}
window.addEventListener("resize", resizeCanvas); resizeCanvas();

function fireConfetti(){
  confs = Array.from({length:160}).map(()=>({
    x: Math.random()*confettiCanvas.width,
    y: -10 - Math.random()*confettiCanvas.height*.5,
    r: 4 + Math.random()*6,
    s: 1 + Math.random()*2.5,
    a: Math.random()*360,
    c: ["#ff7ad9","#9b8cff","#ffd1e8","#c7bfff","#ffe27a"][Math.floor(Math.random()*5)]
  }));
  animateConfetti();
  setTimeout(()=> confs = [], 2000);
}
function animateConfetti(){
  ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  confs.forEach(p=>{
    p.y += p.s*2;
    p.x += Math.sin(p.a/30)*1.5;
    p.a += 3;
    ctx.fillStyle = p.c;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
  });
  if(confs.length) requestAnimationFrame(animateConfetti);
}

/* ---------- ì‹œì‘ ìƒíƒœ ---------- */
document.addEventListener("DOMContentLoaded", ()=>{
  // nothing else
});
</script>
</body>
</html>
